<!DOCTYPE html><html lang="en" ><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="Jekyll v4.0.0" /><meta property="og:title" content="How to delete files correctly?" /><meta name="author" content="Yong Huang" /><meta property="og:locale" content="en_US" /><meta name="description" content="This is an old post that I wrote a few years ago, and I think I stole much of from someone else on the Internet, if you happen to find this post, please reach out to me so I can delete it or credit you properly." /><meta property="og:description" content="This is an old post that I wrote a few years ago, and I think I stole much of from someone else on the Internet, if you happen to find this post, please reach out to me so I can delete it or credit you properly." /><link rel="canonical" href="http://localhost:4000/notes/2023/06/07/delete-files" /><meta property="og:url" content="http://localhost:4000/notes/2023/06/07/delete-files" /><meta property="og:site_name" content="Notes" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-06-07T21:02:35-07:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="How to delete files correctly?" /><meta name="twitter:site" content="@" /><meta name="twitter:creator" content="@Yong Huang" /> <script type="application/ld+json"> {"dateModified":"2023-06-07T21:02:35-07:00","datePublished":"2023-06-07T21:02:35-07:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/notes/2023/06/07/delete-files"},"author":{"@type":"Person","name":"Yong Huang"},"url":"http://localhost:4000/notes/2023/06/07/delete-files","description":"This is an old post that I wrote a few years ago, and I think I stole much of from someone else on the Internet, if you happen to find this post, please reach out to me so I can delete it or credit you properly.","@type":"BlogPosting","headline":"How to delete files correctly?","@context":"https://schema.org"}</script><title> How to delete files correctly? - Notes</title><link rel="shortcut icon" href="/notes/favicon.png"><link rel="alternate" type="application/atom+xml" title="Notes" href="/notes/atom.xml"><link rel="alternate" type="application/json" title="Notes" href="http://localhost:4000/notes/feed.json" /><link rel="sitemap" type="application/xml" title="sitemap" href="/notes/sitemap.xml" /><style> *,:after,:before{box-sizing:border-box;background-color:inherit;color:inherit;margin:0;padding:0}body{font-family:system-ui, sans-serif;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility;line-height:1.5;font-size:1rem;color:#16171a}nav ul{border-right:1px solid #edf2f7}a{color:#000;text-decoration-skip-ink:auto;text-decoration:underline}pre{margin:.5rem 0;padding:.5rem}.post p{margin:.5rem 0}.post h1,.post h2,.post h3,.post h4{margin:1rem 0}.post h2:first-child,.project h2:first-child,.photo h2:first-child{margin-top:0}.meta{margin:2rem 0}code,pre{background:#ecedee}code{padding:.1rem}pre code{border:none}pre{padding:1rem;overflow-x:auto}img{max-width:100%}hr{background:#000;height:1px;border:0}header{flex-basis:10rem;flex-grow:1;position:relative}header a{text-decoration:none}header li{margin-bottom:.2rem;text-align:right;margin-right:2rem}header a.active{font-weight:bold}header,section{padding:1rem}blockquote{font-style:italic;border-left:5px solid #ececec;padding-left:1rem}h1,h2,h3,h4,h5{line-height:1;margin:1rem 0;font-weight:600}section h1:first-child{margin-top:0}strong,b{font-weight:bold}.photos ul{list-style:none}.photos li{margin-bottom:1.5rem}.photo picture,.project picture{margin-bottom:0.5rem}.posts ul,header ul{list-style:none}.posts li{align-items:center;display:flex;justify-content:space-between;margin-bottom:.5rem}.posts li a,.posts li div,.projects li a{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-decoration:none}.posts li time,.projects li time{padding-left:1rem;white-space:nowrap;font-variant-numeric:tabular-nums}main{display:flex;flex-wrap:wrap;max-width:60rem;margin:2rem auto;padding:1rem}@media screen and (max-width: 45rem){header li{display:inline;margin-right:1rem}.logo{padding-bottom:1rem}header ul{border-bottom:1px solid #edf2f7;padding-bottom:2rem}nav ul{border-right:0px}.photos ul{margin-top:0.5rem}}section{flex-basis:0;flex-grow:999;min-width:70%;display:flex;flex-direction:column}figcaption{font-size:smaller}@media print{.no-print,.no-print *{display:none !important}}</style></head><body><main><header aria-hidden="true" class="no-print"> <!--<h1 class="logo">Notes</h1>--><nav role="navigation" aria-hidden="true"><ul><li><a href="/notes" >Notes</a></li><li><a href="/notes/about" >About</a></li><li><a href="/notes/search" >Search</a></li></ul></nav></header><section class="post"><h2>How to delete files correctly?</h2><p>This is an old post that I wrote a few years ago, and I think I stole much of from someone else on the Internet, if you happen to find this post, please reach out to me so I can delete it or credit you properly.</p><h2 id="overview">Overview</h2><p>This is a tutorial on using the command line to delete files in your computer, in the right way.</p><h2 id="what-will-happen-when-you-use-rm-to-delete-large-amount-of-files">what will happen when you use <strong>rm</strong> to delete large amount of files</h2><p>I had this problem lately, I had over 27 million small files, each less than 100KB in one single directory by mistake. and when I want to delete them all, the <strong>rm</strong> command does not work properly, it takes way to much time to finish, so whatâ€™s wrong about it? the problem is that rm command is invoked for each and every file in the list. For example, if there are 50 files in the folder which are bigger than 7M, then 50 rm commands are invoked for deleting each of them. This will take a much longer time.</p><p>So are there any other method to solve this?</p><h2 id="find-command-with--exec">Find Command with -exec</h2><p>example:</p><pre><code class="language-shell">find /test -type f -exec rm {}
</code></pre><p>The above shown command, will delete all the files inside /test directory. First the find command will look for all files inside the directory, and then for each result, it will execute and rm</p><p>essentially this command is not different from rm command, however,in practice, this would be a little faster than the raw rm command. it tooks around 14 Minute for half a million files, depending on your individual file size.</p><h2 id="find-command-with--delete">Find Command with -delete</h2><p>example:</p><pre><code class="language-shell">find ./ -type f -delete
</code></pre><p>this command is actually much faster than the above command. it tooks around 5 Minute for half a million files, depending on your individual file size.</p><h2 id="perl">Perl</h2><p>example:</p><pre><code class="language-shell">perl -e 'for(&lt;*&gt;){((stat)[9]&lt;(unlink))}'
</code></pre><p>this is actually the fatstest option. it tooks around 1 Minute for half a million files, depending on your individual file size.</p><p>But yeah if you are interested in deleting files using Perl, you need to have some good hands on with Perl regular expressions.</p><p>There is one more lesser used and less known method that can be used to delete large number of files inside a folder. This method is none other than our famous tool RSYNC used for transferring and synchronizing files between two local as well as remote locations in Linux</p><h2 id="rsync-with--delete">RSYNC with -delete</h2><p>This can be achieved by simply synchronizing a target directory which has the large number of files, with an empty directory. In our case test directory has half a million files, lets create a directory called as blanktest, which will be kept empty for the purpose of simply synchronization. Now along with this we will be using -delete option in rsync, which will delete all those files in the target directory, which are are not present in the source</p><p>example:</p><p>Empty Directory: /home/blanktest</p><p>Directory to be emptied: /test</p><pre><code class="language-shell">rsync -a --delete blanktest/ test/
</code></pre><p>this command tooks around 2 minutes to delete all files. Cool!</p><h2 id="one-last-note">One last note</h2><p>Linux and other operating systems have some limits in their file systems, it is not a good idea to put too many files in one single directory, if you want to store large amount of files, a good idea would be store these files subdirectories and the ideal amount of files in one single subdirecotries is less than 10000.</p><span class="meta"><time datetime="2023-06-07T21:02:35-07:00">June 7, 2023</time> &middot; <a href="/notes/tags/tools">tools</a></span></section></main></body></html>
